<script src="https://rawgit.com/jonobr1/two.js/master/build/two.min.js"/></script>
<script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"></script>
<script type="text/javascript" src="memory.js"></script>


<div id="canvas"><div></div></div>

<div>
	<a>N</a><textarea id="N" rows="1" cols="6" style="resize:none">50</textarea>
	<a>L</a><textarea id="L" rows="1" cols="6" style="resize:none">1.0</textarea>
	<button onclick="KC = new kc_t(parseInt($('#N').val()), parseFloat($('#L').val()))">CREATE</button>

<button onclick="temp = new kc_t(parseInt($('#N').val()), parseFloat($('#L').val()));kc_transfer(KC,temp);KC=temp">CREATE AND TRANSFER</button>
</div>
<div>
	<a>input</a><textarea id="input" rows="1" cols="6" style="resize:none">0.5</textarea>
	<button onclick="$('#output').val(kc_predict(KC, parseFloat($('#input').val())))">EVALUATE</button>
	<textarea id="output" rows="1" cols="6" style="resize:none"></textarea>
</div>
<div>
	<a>I</a><textarea id="I" rows="1" cols="6" style="resize:none">0.5</textarea>
	<a>E</a><textarea id="E" rows="1" cols="6" style="resize:none">100</textarea>
	<a>DELTA</a><textarea id="DELTA" rows="1" cols="6" style="resize:none">0.001</textarea>
	<button onclick="I = parseFloat($('#I').val());E = parseFloat($('#E').val());DELTA = parseFloat($('#DELTA').val());kc_train(KC, I, E, DELTA);$('#trained').val(kc_predict(KC, I))">TRAIN</button>
	<button onclick="I = parseFloat($('#I').val());E = parseFloat($('#E').val());DELTA = parseFloat($('#DELTA').val());kc_train_a(KC, I, E, DELTA);$('#trained').val(kc_predict(KC, I))">TRAIN A</button>
	 <button onclick="I = parseFloat($('#I').val());E = parseFloat($('#E').val());DELTA = parseFloat($('#DELTA').val());kc_train_b(KC, I, E, DELTA);$('#trained').val(kc_predict(KC, I))">TRAIN B</button>
	 <textarea id="trained" rows="1" cols="6" style="resize:none"></textarea>
</div>
<div>
    <textarea id="batchI" row="8" cols="30" placeholder="batch I array">[0,0.1,0.2,0.3,0.4,0.5,0.6,0.7,0.8,0.9]</textarea>
    <textarea id="batchE" row="8" cols="30" placeholder="batch E array">[-100,100,-100,100,-100,100,-100,100,-100,100]</textarea>
    <textarea id="batchDELTA" row="8" cols="30" placeholder="batch DELTA array">[0.001,0.001,0.001,0.001,0.001,0.001,0.001,0.001,0.001,0.001]</textarea>
	<button onclick="BATCH()">BATCH</button><a id="success"></a>
</div>
<div>
	<button onclick="CLEAR();DRAW(KC, parseInt($R.val()));TWO.update()">REFRESH</button>
	<a>R</a><textarea id="R" rows="1" cols="10" style="resize:none">10000</textarea>
</div>

<script type="text/javascript">
	$(this).ready(() => {
		let $canvas = $("#canvas");
		let WIDTH = 900;
		let HEIGHT = 300;
                $R = $("#R");
		$N = $("#N");
		$L = $("#L");
		KC = new kc_t(parseInt($N.val()), parseFloat($L.val()));
		TWO = new Two({width: WIDTH, height: HEIGHT}).appendTo($canvas.get(0));
		CLEAR = function() {
			TWO.clear();
			let yaxis = TWO.makePath(WIDTH/2.0, 0, WIDTH/2.0, HEIGHT);
			yaxis.fill = 'none';
			yaxis.linewidth = 2.0;
			yaxis.stroke = "blue";
		}
		CLEAR();
		DRAW = function (kc, resolution=10000) {
			let points = [];
			let outputs = [];
			let step = WIDTH / (2.0 * kc.L);
			let max = undefined;
			let min = undefined;

			for(let i = 0; i < resolution; ++i)
			{
				let x = ((i/resolution) * (2.0 * kc.L)) - kc.L;
				let y = -1*kc_predict(kc, x);
				outputs.push(x);
				outputs.push(y);
				if(max === undefined && min === undefined) { max = y; min = y; }
				else if(y < min) min = y;
				else if(y > max) max = y;
			}

			for(let i = 0; i < resolution; ++i)
			{
				let vx = outputs[i*2];
				let vy = outputs[i*2 + 1];

				let x = (vx + kc.L) * step;
				let y = ((vy - min) / (max - min)) * HEIGHT;

				points.push(x);
				points.push(y);
			}

                        let midh = (0 > min) ? ((-min/(max-min))*HEIGHT) : 0;
                        let xaxis = TWO.makePath(0, midh, WIDTH, midh);
			xaxis.fill = 'none';
			xaxis.linewidth = 2.0;
			xaxis.stroke = "blue";

			let curve = TWO.makeCurve(...points, true);

			curve.fill = 'none';

			return curve;
		}
$batchI = $("#batchI");
$batchE = $("#batchE");
$batchDELTA = $("#batchDELTA");
$success = $("#success")
BATCH = function() {
$success.val("loading");
setTimeout(100,function(){
try{
    let Is = eval("(function(){return "+$batchI.val()+";})()");
    let Es = eval("(function(){return "+$batchE.val()+";})()");
    let Ds = eval("(function(){return "+$batchDELTA.val()+";})()");
    let l = Is.length > Es.length ? (Es.length > Ds.length ? Ds.length : Es.length) : (Is.length > Ds.length ? Ds.length : Is.length);
    for(let i = 0; i < l; ++i) {
        kc_train(KC, Is[i], Es[i], Ds[i]);
    }
    let success = true;
    for(let i = 0; i < l && success; ++i) {
        success = Math.sign(Es[i]) === Math.sign(kc_predict(KC, Is[i]));
    }
    $success.val(success?"passed":"failed");
} catch(e) { document.write(e.toString())}});
}
	});
</script>
